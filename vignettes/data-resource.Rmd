---
title: "Data Resource"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Data Resource}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

[Data Resource](https://specs.frictionlessdata.io/data-resource/) (further referred to as "resource") is a simple format to describe a data resource such as a individual table or file, including its name, format, path, etc.

## Support

### Reading

frictionless can read a Data Package with resources of any type. You can list those with `resources()`:

```{r}
library(frictionless)
x <- example_package

# List resources
resources(x)
```

You can remove any of those resources with `remove_resource()`:

```{r}
# Remove resource (but don't assign to x)
remove_resource(x, "deployments")
```

Reading the data from a resource with `read_resource()` is limited to [Tabular Data Resources](https://specs.frictionlessdata.io/tabular-data-resource/):

```{r}
# Read (tabular) resource
read_resource(x, "deployments")
```

### Writing

When creating or replacing a resource, `add_resource()` only supports Tabular Data Resources. The provided data must therefore be a data frame or a tabular file (e.g. CSV):

```{r}
# Add (tabular) resource from a data frame (but don't assign to x)
add_resource(x, "iris", data = iris)

# Replace a (tabular) resource from a file (but don't assign to x)
path <- system.file("extdata", "deployments.csv", package = "frictionless")
add_resource(x, "deployments", data = path, replace = TRUE)
```

`write_package()` will leave originally included resources as is and write newly added as Tabular Data Resources.

## Properties

The following sections describe how frictionless supports the Data Package properties.

### name

[`name`](https://specs.frictionlessdata.io/data-resource/#name) is required. It is used to identify a resource in `read_resource()`, `add_resource()` and `remove_resource()` (always as the second argument):

```{r}
deployments <- read_resource(x, resource_name = "deployments")
```

When creating a resource, `add_resource()` will set `name` to the provided `resource_name`.

### path or data

[`path`](https://specs.frictionlessdata.io/data-resource/#data-location) or `data` is required. Providing both is not allowed.

#### path

`path` is for data in files (e.g. a CSV file). It can be a local path or URL, as long as it resolves. Supported protocols are `http`, `https`, `ftp`, `sftp` and `sftp`. Absolute paths (`/`) or relative parent paths (`../`) are not allowed to avoid security vulnerabilities.

When multiple paths are provided (`"path": ["myfile1.csv", "myfile2.csv"]`), the files are expected to have the same structure. `read_resource()` will merge these into a single data frame in the order the paths are provided (using `dplyr::bind_rows()`):

```{r}
# The "observations" resource has multiple files in path
x$resources[[2]]$path
# These are combined into a single data frame when reading
read_resource(x, "observations")
```

When creating a resource from a file, `add_resource()` will add the provided path(s) to `path`.

#### data

_Note: Support for inline `data` is currently limited, e.g. JSON object and string are not supported. `schema`, `mediatype` and `format` are also ignored._

`data` is for inline data (included in the `datapackage.json`). `read_resource()` will attempt to read `data` if it is provided as a JSON array:

```{r}
# The "media" resource has inline data
str(x$resources[[3]]$data)
read_resource(x, "media")
```

When creating a resource from a data frame, `add_resource()` will (temporarily) add the data frame to `data`:

```{r}
df <- data.frame("col_1" = c(1, 2), "col_2" = c("a", "b"))
x <- add_resource(x, "df", df)
x$resources[[4]]$data
```

`write_package()` will write the data frame to a CSV file, add its `path` and remove `data`.

<!-- ### type -->

<!-- ### $schema -->

### profile

[`profile`](https://specs.frictionlessdata.io/data-resource/#profile) is required to have the value `"tabular-data-resource"`.

When creating a resource, `add_resource()` will automatically set `profile` to `"tabular-data-resource"`.

### schema

See `vignette("table-schema")`.

### dialect

See `vignette("table-dialect")`.

### title

[`title`](https://specs.frictionlessdata.io/data-resource/#title) is ignored by `read_resource()`.

When creating a resource, you can set `title` with `add_resource()`:

```{r}
x <- add_resource(x, "iris", iris, title = "Edgar Anderson's Iris Data")
```

### description

[`description`](https://specs.frictionlessdata.io/data-resource/#description) is ignored by `read_resource()`.

When creating a resource, you can set `description` with `add_resource()` (cf. `title`).

### format

[`format`](https://specs.frictionlessdata.io/data-resource/#format) is ignored by `read_resource()`.

When creating a resource from a file, `add_resource()` will set `format` based on the provided `delim` (`","` (default) = `"csv"`, `"\t"` = `"tsv"`, any other value = `"csv"`).

When creating a resource from a data frame, `format` remains undefined until `write_package()` sets it to `"csv"`.

### mediatype

[`mediatype`](https://specs.frictionlessdata.io/data-resource/#mediatype) is ignored by `read_resource()`.

When creating a resource from a file, `add_resource()` will set `mediatype` based on the provided `delim` (`","` (default) = `"text/csv"`, `"\t"` = `"text/tab-separated-values"`, any other value = `"text/csv"`).

When creating a resource from a data frame, `mediatype` remains undefined until `write_package()` sets it to `"text/csv"`.

### encoding

[`encoding`](https://specs.frictionlessdata.io/data-resource/#encoding) (e.g. `"windows-1252"`) is used by `read_resource()` to parse the file. It will default to UTF-8 if no `encoding` is provided or if it cannot be recognized. The returned data frame will always be UTF-8.

When creating a resource from a file, `add_resource()` will guess the `encoding` (using `readr::guess_encoding()`).

When creating a resource from a data frame, `encoding` remains undefined until `write_package()` sets it to `"utf-8"`.

### bytes

[`bytes`](https://specs.frictionlessdata.io/data-resource/#bytes) is ignored by `read_resource()`.

When creating a resource, you can set `bytes` with `add_resource()` (cf. `title`).

### hash

[`hash`](https://specs.frictionlessdata.io/data-resource/#hash) is ignored by `read_resource()`.

When creating a resource, you can set `hash` with `add_resource()` (cf. `title`).

### sources

[`sources`](https://specs.frictionlessdata.io/data-resource/#sources) is ignored by `read_resource()`.

When creating a resource, you can set `sources` with `add_resource()` (cf. `title`).

### licenses

[`licenses`](https://specs.frictionlessdata.io/data-resource/#licenses) is ignored by `read_resource()`.

When creating a resource, you can set `licenses` with `add_resource()` (cf. `title`).

### compression

[`compression`](https://specs.frictionlessdata.io/patterns/#specification-3) (a recipe) is ignored by `read_resource()` and not set by `add_resource()`.

Compression is derived from the provided `path`. If the `path` ends in `.gz`, `.bz2`, `.xz`, or `.zip`, the files are automatically decompressed by `read_resource()` (using default `readr::read_delim()` functionality). Only `.gz` files can be read directly from URL `path`s.
