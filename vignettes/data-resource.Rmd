---
title: "Data Resource"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Data Resource}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

[Data Resource](https://specs.frictionlessdata.io/data-resource/) (further referred to as "resource") is a simple format to describe a data resource such as an individual table or file, including its name, format, path, etc.

## Support

frictionless supports reading, manipulating and writing resources, but much of its functionality is restricted to [Tabular Data Resources](https://specs.frictionlessdata.io/tabular-data-resource/).

### Read

You can list all resources in a Data Package with `resources()`:

```{r}
library(frictionless)
package <- example_package()

# List the resources
resources(package)
```

`read_resource()` allows you to read data from a tabular resource to a data frame:

```{r}
read_resource(package, "deployments")
```

frictionless does not support reading data from non-tabular resources.

### Manipulate

You can remove a resource (of any type) with `remove_resource()`:

```{r}
# To update package, use package <- remove_resource(package, "deployments")
remove_resource(package, "deployments")
```

Using `add_resource()`, you can add or replace a resource as long as it is tabular. The provided data must therefore be a data frame or a tabular data file (e.g. CSV):

```{r}
# Add a resource with data from a data frame
package <- add_resource(package, "iris", data = iris)

# Replace a resource with one where data is stored in a tabular file
path <- system.file("extdata", "deployments.csv", package = "frictionless")
package <- add_resource(package, "deployments", data = path, replace = TRUE)
```

### Write

You can write a Data Package to disk with `write_package()`. This function will create a `datapackage.json` file and CSV files for any newly created resources.

## Properties

The sections below describe how frictionless supports resource properties.

### name

[`name`](https://specs.frictionlessdata.io/data-resource/#name) is required. It is used to identify a resource in `read_resource()`, `add_resource()` and `remove_resource()` (always as the second argument):

```{r}
deployments <- read_resource(package, resource_name = "deployments")
```

When creating a resource, `add_resource()` sets `name` to the provided `resource_name`.

### path

[`path`](https://specs.frictionlessdata.io/data-resource/#data-location) or `data` (see further) is required. Providing both is not allowed.

`path` is for data in files (e.g. a CSV file). It can be a local path or URL. Supported protocols are `http`, `https`, `ftp`, `sftp` and `sftp`. Absolute paths (`/`) or relative parent paths (`../`) are not allowed to avoid security vulnerabilities.

When multiple paths are provided (`"path": ["myfile1.csv", "myfile2.csv"]`), the files are expected to have the same structure. `read_resource()` merges these into a single data frame in the order the paths are provided (using `dplyr::bind_rows()`):

```{r}
# The "observations" resource has multiple files in path
package$resources[[2]]$path
# These are combined into a single data frame when reading
read_resource(package, "observations")
```

When creating a resource from a file, `add_resource()` adds the provided path(s) to `path`.

### data

_Note: Support for inline `data` is currently limited, e.g. JSON object and string are not supported and `schema`, `mediatype` and `format` are ignored._

`data` is for inline data (included in the `datapackage.json`). `read_resource()` attempts to read `data` if it is provided as a JSON array:

```{r}
# The "media" resource has inline data
str(package$resources[[3]]$data)
read_resource(package, "media")
```

When creating a resource from a data frame, `add_resource()` (temporarily) adds the data frame to `data`:

```{r}
df <- data.frame("col_1" = c(1, 2), "col_2" = c("a", "b"))
package <- add_resource(package, "df", df)
package$resources[[5]]$data
```

`write_package()` writes the data frame to a CSV file, adds its `path` and removes `data`.

<!-- ### type -->

<!-- ### $schema -->

### profile

[`profile`](https://specs.frictionlessdata.io/data-resource/#profile) is required to have the value `"tabular-data-resource"`.

When creating a resource, `add_resource()` automatically sets `profile` to `"tabular-data-resource"`.

### schema

See `vignette("table-schema")`.

### dialect

See `vignette("table-dialect")`.

### title

[`title`](https://specs.frictionlessdata.io/data-resource/#optional-properties) is ignored by `read_resource()`.

When creating or replacing a resource, you can set `title` with `add_resource()`:

```{r}
package <- add_resource(
  package,
  "iris",
  iris,
  title = "Edgar Anderson's Iris Data",
  replace = TRUE
)
```

### description

[`description`](https://specs.frictionlessdata.io/data-resource/#optional-properties) is ignored by `read_resource()`.

When creating a resource, you can set `description` with `add_resource()` (cf. `title`).

### format

[`format`](https://specs.frictionlessdata.io/data-resource/#optional-properties) is ignored by `read_resource()`.

When creating a resource from a file, `add_resource()` sets `format` based on the provided `delim` (`","` (default) = `"csv"`, `"\t"` = `"tsv"`, any other value = `"csv"`).

When creating a resource from a data frame, `format` remains undefined until `write_package()` sets it to `"csv"`.

### mediatype

[`mediatype`](https://specs.frictionlessdata.io/data-resource/#optional-properties) is ignored by `read_resource()`.

When creating a resource from a file, `add_resource()` sets `mediatype` based on the provided `delim` (`","` (default) = `"text/csv"`, `"\t"` = `"text/tab-separated-values"`, any other value = `"text/csv"`).

When creating a resource from a data frame, `mediatype` remains undefined until `write_package()` sets it to `"text/csv"`.

### encoding

[`encoding`](https://specs.frictionlessdata.io/data-resource/#optional-properties) (e.g. `"windows-1252"`) is used by `read_resource()` to parse the file. It defaults to UTF-8 if no `encoding` is provided or if it cannot be recognized. The returned data frame will always be UTF-8.

When creating a resource from a file, `add_resource()` guesses the `encoding` (using `readr::guess_encoding()`).

When creating a resource from a data frame, `encoding` remains undefined until `write_package()` sets it to `"utf-8"`.

### bytes

[`bytes`](https://specs.frictionlessdata.io/data-resource/#optional-properties) is ignored by `read_resource()`.

When creating a resource, you can set `bytes` with `add_resource()` (cf. `title`).

### hash

[`hash`](https://specs.frictionlessdata.io/data-resource/#optional-properties) is ignored by `read_resource()`.

When creating a resource, you can set `hash` with `add_resource()` (cf. `title`).

### sources

[`sources`](https://specs.frictionlessdata.io/data-resource/#optional-properties) is ignored by `read_resource()`.

When creating a resource, you can set `sources` with `add_resource()` (cf. `title`).

### licenses

[`licenses`](https://specs.frictionlessdata.io/data-resource/#optional-properties) is ignored by `read_resource()`.

When creating a resource, you can set `licenses` with `add_resource()` (cf. `title`).

### compression

[`compression`](https://specs.frictionlessdata.io/patterns/#specification-3) (a recipe) is ignored by `read_resource()` and not set by `add_resource()`.

Compression is derived from the provided `path`. If the `path` ends in `.gz`, `.bz2`, `.xz`, or `.zip`, the files are automatically decompressed by `read_resource()` (using default `readr::read_delim()` functionality). Only `.gz` files can be read directly from URL `path`s.
